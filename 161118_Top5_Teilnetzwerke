# TEILNETZWERKE WERBEKOOPERATIONEN UND SOZIALES ENGAGEMENT UND DEREN TOP 5

# IGRAPH-OBJEKT GESAMTNETZWERK DFB

library(igraph)

el <- read.csv("https://raw.githubusercontent.com/hdm-rz015/DFB_Netzwerk/master/101118_Edgelist_einfach.csv", header=T, as.is=T, sep = ",")
nodes <- read.csv("https://raw.githubusercontent.com/hdm-rz015/DFB_Netzwerk/master/271018_Nodelist.csv", header=T, as.is=T, sep = ",")

head(el)
head(nodes)

hties <-as.matrix(el)
dfb <- graph_from_data_frame(d=hties, vertices=nodes, directed=F)
dfb
plot(dfb)

#----------------------------------------------------------------------------------------------

# SELEKTION VON ZWEI TEILNETZWERKEN
# Das Teilnetzwerk soziales Engagement (soz) wird mit dem Teilnetzwerk Werbekooperationen (werb) verglichen. 

# Selektion in Teilnetzwerk soz und werb
edge.attributes(dfb)
edge.attributes(dfb)$relationship
# das Edge-Attribut relationship ist in "1" (Soziales) und "2" (Werbekooperationen) kodiert.

#-----------------------------------------------------------------------------------------------

# TEILNETZWERK SOZIALES ENGAGEMENT

soz <- subgraph.edges(dfb, E(dfb)[relationship == 1])
soz
edge.attributes(soz)$relationship

# Visualisierung des Teilnetzwerks soz

# Die Beschriftung der Knoten (Label) entspricht dem Attribut "Akteursbezeichnungen".
V(soz)$label <- V(soz)$akteursbezeichnung

# Färbung der Knoten
# Im Teilnetzwerk werden die Spieler und ihr soziales Engagement dargestellt.
# Das Vertex-Attribut $type definiert mit "1" die Spieler und mit "3" das soziale Engagement.
vertex.attributes(soz)$type

# Färbung der Knoten
# Die Akteure werden abhängig von dem Attribut $type verschieden eingefärbt.
# Das Farbspektrum wird definiert und mit dem neuen Vector faerbung festgelegt.
# Da das Attribut $type drei Werte hat (Spieler, Werbekooperationen, soziales Engagement), werden drei unterschiedliche Farben benötigt.
faerbung <- c("chartreuse2", "honeydew3", "springgreen4")

# Das Vertex-Attribut color wird definiert und die Funktion "faerbung" ihm zugewiesen.
V(soz)$color <- faerbung[V(soz)$type]

# Form der Akteure bestimmen
# definiert, dass alle Knoten als square auftreten.
V(soz)$shape = "square"

# wählt alle Knoten aus, die das Vertex-Attribut "1" bei $type gesetzt haben.
spieler <- V(soz)[type == "1"]
spieler

# weist allen Werten von "spieler" den shape "cirle" zu.
V(soz)[spieler]$shape = "circle"

plot(soz)




# Das Teilnetzwerk wird mit der Variable coords entzerrt und mit dem Fruchterman-Rheingold Algorithmus visualisiert.
coords <- layout_with_fr(soz)*1.2

# Festlegung der relativen Knotengröße
# berechnet die Degree-Werte für alle Knoten und weist diese der Variable "knotengroesse" zu.
knotengroesse <- degree(soz)
knotengroesse

# bestimmt die farbliche Umrandung der Knoten
vertex.attributes(soz)$frame.color
V(soz)$frame.color = "gray45"

# legt die Schrift der Knotenbezeichnungen fest 
vertex.attributes(soz)$label.family
V(soz)$label.family = "Helvetica"

# legt die Schriftfarbe der Knotenbezeichnungen fest
vertex.attributes(soz)$label.color
V(soz)$label.color = "gray20"

# legt die Kantenfarbe fest
edge.attributes(soz)$edge.color
E(soz)$color = "gray30"

# ---------------------------------------------------------

plot(soz, 
     vertex.size=knotengroesse*15, # führt die relative Größe der Knoten aus
     layout=coords, # entzerrt das Netzwerk
     edge.curved=.2, # bestimmt den Krümmungsgrad der Kanten
     edge.width=E(soz)$weight, # legt die Kantenstärke fest
     rescale=FALSE, ylim=c(-5,10), xlim=c(-3,18), asp = 0, # legt die Fenstergröße fest 
     main="Teilnetzwerk Soziales Engagement") # Überschrift des Netzwerks

# ---------------------------------------------------------

# DIE 5 SPIELER MIT DEM HÖCHSTEN DEGREE-WERT

degree(soz)

# die Spieler mit dem höchsten Degree-Werten lassen sich aus der Liste ablesen
# Thomas Müller hat die meisten Degrees, nämlich 6.
# 6 weitere Spieler haben jeweils den Degree-Wert 3, daher ergibt sich im Teilnetzwerk soziales Engagement eine Top 7.

V(soz)$degree <- degree(soz)
soztop <- delete_vertices(soz, V(soz)[degree <= "2"]) 
soztop

plot(soztop,
     layout=layout_with_fr,
     vertex.frame.color="gray45", 
     vertex.label.family = "Helvetica", 
     vertex.label.color = "gray20", 
     edge.color="gray30",
     edge.curved=.2,
     main="Top 7 soziales Engagement",
)

# interessant: 5 der 7 Spieler mit dem höchsten sozialen Engagement engagieren sich für United Charity





# ------------------------------------------------------------------------------------------

# TEILNETZWERK WERBEKOOPERATIONEN

werb <- subgraph.edges(dfb, E(dfb)[relationship == 2])
werb
edge.attributes(werb)$relation


# EINFÄRBEN aufgrund von Vertex-Attributen

# Im Netzwerk sind Spieler, Engagement und Werbekooperationen abgelegt, die über das Vertex.Attribut $type mit "1" (Spieler) oder "2" (Werbekooperationen) oder "3" (soziales Engagement) kodiert sind.
vertex.attributes(werb)$type

#Alle Akteure sollen nun in verschiedenen Farben visualisiert werden.

#FARBEN nach Vertex-Attributen definieren
faerbung <- c("chartreuse2", "honeydew3", "springgreen4")

#definiert das Farbspektrum, der verwendeten Farben und legt diese in einem neuen Vector faerbung fest. Da wir wissen, dass wir bei §Type nur drei Werte haben (Spieler, Werbekooperationen, soziales Engagement) brauchen wir auch drei Werte. Die direkten Farbpaletten sind hier hinterlegt: http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf.

V(werb)$color <- faerbung[V(werb)$type]
# weist dem Vertex-Attribut color die Funktion faerbung zu, die wir vorher mit drei Farben definiert haben.

plot(werb)

# FORM DER AKTEURE ANPASSEN

V(werb)$shape = "square"
# definiert, dass alle Knoten als square auftreten

spieler <- V(werb)[type == "1"]
# wöhlt alle Knoten aus, die das Vertex-Attribut "1" bei type gesetzt haben

spieler

V(werb)[spieler]$shape = "circle"
# weist allen Werten von spieler den Shape "cirle" zu.

plot(werb)


# Das Netzwerk wird entzerrt mit der Variable
coords <- layout_with_kk(werb)*0.5

# Relative Werte durch die Größe der Knoten abbilden

# berechnet den Degree-Wert für alle Knoten und weist ihm die Variable "knotengroesse" zu.
knotengroesse <- degree(werb)
knotengroesse

# plottet da Netzwerk und ändert die Größe des Knotens nach dem Degree-Wert
par(mfrow=c(1,1)) 

# änder die Bezeichnung der Akteure
V(werb)$label <- V(werb)$akteursbezeichnung

plot(werb, 
     vertex.size=knotengroesse*3, # führt die relative Größe der Knoten aus
     vertex.frame.color="black", 
     vertex.label.family = "Helvetica", 
     vertex.label.color = "grey25", 
     layout=coords, 
     edge.color="grey80",
     edge.curved=.2,
     edge.width=E(werb)$weight,
     rescale=FALSE, 
     ylim=c(-1.5,3),
     xlim=c(-2.5,3), 
     asp = 0,
     main="Teilnetzwerk Werbekooperationen")


# DIE 5 SPIELER MIT DEM HÖCHSTEN DEGREE-WERT

degree(werb)

# die 5 Spieler mit dem höchsten Degree-Wert lassen sich aus der Liste ablesen
# die Spieler mit den meisten Werbe-Degrees sind Thomas Müller, Manuel Neuer und Mats Hummels

V(werb)$degree <- degree(werb)
werbtop <- delete_vertices(werb, V(werb)[degree <= "4"])
werbtop
plot(werbtop,
     layout=layout_with_kk,
     vertex.size=knotengroesse*7, # führt die relative Größe der Knoten aus
     vertex.frame.color="black", 
     vertex.label.family = "Helvetica", 
     vertex.label.color = "grey25", 
     edge.color="grey80",
     edge.curved=.2,
)

# interessant: Die 5 Spieler mit den meisten Werbekooperationen haben keine gemeinsame Werbekooperation


# -----------------------------------------

# FUNKTIONIERT NOCH NICHT:
# Gegenüberstellung Top 7 soziales Engagement <--> Top 5 Werbekooperationen

# direkter Vergleich der beiden Netzwerke herstellen


par(mfrow=c(1,2), mar=c(0,0,2,0))

plot(soztop[[1]], 
     layout=layout_with_kk,
     main="Top 7 Werbekooperationen",
     edge.curved=.2, # bestimmt den Krümmungsgrad der Kanten
     edge.width=E(soztop)$weight, #legt die Kantenstärke fest
)


plot(werbtop[[1]], 
     layout=layout_with_kk,
     main="Top 5 Werbekooperationen",
     edge.curved=.2, # bestimmt den Krümmungsgrad der Kanten
     edge.width=E(werbtop)$weight, #legt die Kantenstärke fest
)

# Wieso kann man diese 2 Teilnetzwerke nicht nebeneinander stellen? Man kann die Daten zwar dennoch vergleiche, aber nebeineinader wäre schöner

#-----------------------

# INTERESSANT: Marco Reus, Thomas Müller und Jerome Boateng kommen in beiden Top-Netzwerken vor
# so haben 3 von 5 Spielern mit den meisten Werbekooperationen auch die meisten sozialen Engagements
# Thomas Mueller ist in beiden Netzwerken auf Platz 1
